<app-show-usuario [usuarioMostrar]="usuarioMostrar"></app-show-usuario>
(volverMostrar) = "volverListaUsuarias (true)"


regimenMostrar:boolean = false;   // encender regimen entre lista de productos/mostrar usuarios
regimenCrear:boolean = false;  // encender regimen crear nuevu usuario

mostrarUsuario(id:number) {
  const findUsuario = this.usuarios.find(usuario => usuario.usuario_id == id);
  if (findUsuario) {
   this.usuarioMostrar = findUsuario;
  } else {
    console.log('Error: no hay usuario con este id: ', id);
  }

  this.regimenMostrar = true;   // Encender el modo de visualisar de usuario
}

crearNuevoUsuario() {
  this.regimenCrear = true;   // Encender el modo de visualisar de usuario
}

// Volver a modo de lista de usuarios
volverListaUsuarias ($flag: boolean) {
  this.regimenMostrar = false;   // Apagar el modo de visualisar de usuario
  this.regimenCrear = false;   // Apagar el modo de crear de usuario

  if ($flag) this.obtenerListaUsuarios();
}

// funccion para obtener la lista con todas usuarios
obtenerListaUsuarios() {
  this.usuariosService.getUsuarios().subscribe (
    (data) => {this.usuarios = data;},
    (error) => { console.log('Error data de producto', error)}
  );

}

}



Request URL: http://localhost:8080/api/usuarios
Referrer Policy: strict-origin-when-cross-origin
Connection: close
Content-type: text/html; charset=UTF-8
Date: Sat, 07 Sep 2024 17:08:27 GMT
Host: localhost:8080
X-Powered-By: PHP/7.4.22
Accept: application/json, text/plain, */*
Accept-Encoding: gzip, deflate, br
Accept-Language: es-ES,es;q=0.9
Connection: keep-alive
Content-Length: 116
Content-Type: application/json
Host: localhost:8080
Origin: http://localhost:4200
Referer: http://localhost:4200/
sec-ch-ua: " Not;A Brand";v="99", "Google Chrome";v="91", "Chromium";v="91"
sec-ch-ua-mobile: ?0
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.101 Safari/537.36
{usuario_id: 122, u_nombre: "pedro", u_login: "pedro", u_password: "qwert123!", u_role: "manager",…}
u_active: false
u_login: "pedro"
u_nombre: "pedro"
u_password: "qwert123!"
u_role: "manager"
usuario_id: 122

Request URL: http://localhost:8080/api/usuarios
Request Method: OPTIONS
Status Code: 204 No Content
Remote Address: 127.0.0.1:8080
Referrer Policy: strict-origin-when-cross-origin
Access-Control-Allow-Headers: content-type
Access-Control-Allow-Methods: POST
Access-Control-Allow-Origin: http://localhost:4200
Access-Control-Max-Age: 0
Cache-Control: no-cache, private
Connection: close
Content-type: text/html; charset=UTF-8
Date: Sat, 07 Sep 2024 17:08:27 GMT
Date: Sat, 07 Sep 2024 17:08:27 GMT
Host: localhost:8080
Vary: Access-Control-Request-Method, Access-Control-Request-Headers
X-Powered-By: PHP/7.4.22
Accept: */*
Accept-Encoding: gzip, deflate, br
Accept-Language: es-ES,es;q=0.9
Access-Control-Request-Headers: content-type
Access-Control-Request-Method: POST
Connection: keep-alive
Host: localhost:8080
Origin: http://localhost:4200
Referer: http://localhost:4200/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.101 Safari/537.36

return [
    'paths' => ['api/*', 'sanctum/csrf-cookie'],
    'paths' => ['api/*'],
    'allowed_methods' => ['*'],
    'allowed_origins' => ['http://localhost:4200'],
    'allowed_origins_patterns' => [
        '/^https:\/\/(.*)\.example\.com$/',
    ],
    'allowed_headers' => ['*'],
    'exposed_headers' => [],
    'max_age' => 0,
    'supports_credentials' => false,
];
<script>
            function previewImage(event) {
        const reader = new FileReader();
        const imageField = document.getElementById("imagePreview");

        reader.onload = function(){
            if(reader.readyState == 2){
                imageField.style.display = "block";
                imageField.src = reader.result;
            }
        }

        reader.readAsDataURL(event.target.files[0]);
    }


</script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    // Объект для хранения количества нажатий для каждой кнопки
    const clickCounts = {};

    // Функция для обработки нажатий на кнопки
    function handleButtonClick(event) {
        const buttonId = event.target.id;
        
        // Проверка, существует ли уже запись для данной кнопки
        if (!clickCounts[buttonId]) {
            clickCounts[buttonId] = 0;
        }

        // Увеличение счетчика для данной кнопки
        clickCounts[buttonId]++;
        
        // Логирование текущего количества нажатий
        console.log(`Button ${buttonId} clicked ${clickCounts[buttonId]} times`);
    }

    // Получение всех кнопок с классом 'anadir'
    const buttons = document.querySelectorAll('.anadir');

    // Добавление обработчика событий на каждую кнопку
    buttons.forEach(button => {
        button.addEventListener('click', handleButtonClick);
    });
});
</script>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Button Click Tracker</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <!-- Пример кнопок -->
    <button class="anadir" id="button1">Button 1</button>
    <button class="anadir" id="button2">Button 2</button>
    <button class="anadir" id="button3">Button 3</button>

    <!-- Таблица для отображения результатов -->
    <table>
        <thead>
            <tr>
                <th>Button ID</th>
                <th>Click Count</th>
            </tr>
        </thead>
        <tbody>
            <tr class="factura-nueva"></tr>
        </tbody>
    </table>

    <script src="script.js"></script>
</body>
</html>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
    // Объект для хранения количества нажатий для каждой кнопки
    const clickCounts = {};

    // Функция для обработки нажатий на кнопки
    function handleButtonClick(event) {
        const buttonId = event.target.id;
        
        // Проверка, существует ли уже запись для данной кнопки
        if (!clickCounts[buttonId]) {
            clickCounts[buttonId] = 0;
        }

        // Увеличение счетчика для данной кнопки
        clickCounts[buttonId]++;
        
        // Логирование текущего количества нажатий
        console.log(`Button ${buttonId} clicked ${clickCounts[buttonId]} times`);

        // Обновление таблицы
        updateTable(buttonId, clickCounts[buttonId]);
    }

    // Функция для обновления таблицы
    function updateTable(buttonId, count) {
        const tableBody = document.querySelector('tbody');
        const existingRow = Array.from(tableBody.querySelectorAll('tr')).find(row => row.dataset.buttonId === buttonId);
        
        if (existingRow) {
            // Обновление существующей строки
            existingRow.querySelector('.click-count').textContent = count;
        } else {
            // Создание новой строки в таблице
            const newRow = document.createElement('tr');
            newRow.dataset.buttonId = buttonId;
            newRow.innerHTML = `
                <td>${buttonId}</td>
                <td class="click-count">${count}</td>
            `;
            tableBody.appendChild(newRow);
        }
    }

    // Получение всех кнопок с классом 'anadir'
    const buttons = document.querySelectorAll('.anadir');

    // Добавление обработчика событий на каждую кнопку
    buttons.forEach(button => {
        button.addEventListener('click', handleButtonClick);
    });
});
</script>


<script>
    // Отправка массива в контроллер

            // Пример массива объектов
            const products = [
            { id: 1, name: 'Product A', price: 10.0 },
            { id: 2, name: 'Product B', price: 20.0 }
        ];

        document.getElementById('sendData').addEventListener('click', function() {
            fetch('/factura/store', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({ products: products })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Data sent successfully:', data);
            })
            .catch(error => {
                console.error('Error sending data:', error);
            });
        });
    </script>

    <!-- CSRF Token for Laravel -->
    <meta name="csrf-token" content="{{ csrf_token() }}">


    <script>   

    public function store(Request $request)
    {
        // Получите массив объектов из запроса
        $products = $request->input('products');

        // Обработайте данные и сохраните их в базу данных
        foreach ($products as $product) {
            Factura::updateOrCreate(
                ['id' => $product['id']], // Поиск по ID для обновления существующих записей
                [
                    'name' => $product['name'],
                    'price' => $product['price']
                ]
            );
        }

        // Верните успешный ответ
        return response()->json(['message' => 'Data processed successfully!']);
    }



    namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Mercancia extends Model
{
    // Указываем, что таблица имеет составной ключ
    public $incrementing = false; // Отключаем автоинкремент, так как ключ составной

    protected $primaryKey = ['m_id_factura', 'm_id_producto']; // Составной ключ

    public $timestamps = false; // Если у вас нет полей created_at и updated_at

    // Метод для работы с составным ключом
    protected function getKeyName()
    {
        return $this->primaryKey;
    }

    // Переопределите метод для получения составного ключа
    public function getKey()
    {
        return [$this->m_id_factura, $this->m_id_producto];
    }
}


@Component({
  selector: 'app-producto-list',
  templateUrl: './producto-list.component.html',
  styleUrls: ['./producto-list.component.css']
})
export class ProductoListComponent implements OnInit {
  productos: Producto[] = [];
  productosConImagen: { producto: Producto, imagenUrl: SafeUrl }[] = [];

  constructor(private sanitizer: DomSanitizer) {}

  ngOnInit(): void {
    // Предполагается, что массив productos уже инициализирован
    this.productos.forEach(producto => {
      const contentType = this.detectImageFormat(producto.p_foto); // Определяем формат изображения
      const base64String = this.arrayBufferToBase64(producto.p_foto);
      const imagenUrl = this.sanitizer.bypassSecurityTrustUrl(`data:${contentType};base64,${base64String}`);
      this.productosConImagen.push({ producto, imagenUrl });
    });
  }

  arrayBufferToBase64(buffer: ArrayBuffer): string {
    let binary = '';
    const bytes = new Uint8Array(buffer);
    const len = bytes.byteLength;
    for (let i = 0; i < len; i++) {
      binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
  }

  detectImageFormat(buffer: ArrayBuffer): string {
    const bytes = new Uint8Array(buffer);
    if (bytes[0] === 0xFF && bytes[1] === 0xD8 && bytes[2] === 0xFF) {
      return 'image/jpeg'; // JPEG
    } else if (bytes[0] === 0x89 && bytes[1] === 0x50 && bytes[2] === 0x4E && bytes[3] === 0x47) {
      return 'image/png'; // PNG
    }
    return 'image/jpeg'; // Дефолтный тип, если формат не распознан
  }
}

        // app.routes.ts
import { Routes } from '@angular/router';
import { HomeComponent } from './components/home/home.component';
import { AboutComponent } from './components/about/about.component';

export const routes: Routes = [
  { path: '', component: HomeComponent },
  { path: 'about', component: AboutComponent },
];

<form [formGroup]="formCreateUser" (ngSubmit)="onSubmit()">
  <!-- Поле u_nombre -->
  <div class="form-group">
    <label for="u_nombre">Имя</label>
    <input id="u_nombre" formControlName="u_nombre" type="text" class="form-control" 
           [ngClass]="{ 'is-valid': formCreateUser.get('u_nombre').valid && formCreateUser.get('u_nombre').touched, 
                        'is-invalid': formCreateUser.get('u_nombre').invalid && formCreateUser.get('u_nombre').touched }">
    <div *ngIf="formCreateUser.get('u_nombre').invalid && formCreateUser.get('u_nombre').touched" class="invalid-feedback">
      Это поле обязательно
    </div>
  </div>

  <!-- Поле u_login -->
  <div class="form-group">
    <label for="u_login">Логин</label>
    <input id="u_login" formControlName="u_login" type="text" class="form-control"
           [ngClass]="{ 'is-valid': formCreateUser.get('u_login').valid && formCreateUser.get('u_login').touched,
                        'is-invalid': formCreateUser.get('u_login').invalid && formCreateUser.get('u_login').touched }">
    <div *ngIf="formCreateUser.get('u_login').invalid && formCreateUser.get('u_login').touched" class="invalid-feedback">
      Это поле обязательно
    </div>
  </div>

  <!-- Группа паролей -->
  <div formGroupName="passGroup" class="form-group">
    <label for="u_password">Пароль</label>
    <input id="u_password" formControlName="u_password" type="password" class="form-control"
           [ngClass]="{ 'is-valid': formCreateUser.get('passGroup.u_password').valid && formCreateUser.get('passGroup.u_password').touched,
                        'is-invalid': formCreateUser.get('passGroup.u_password').invalid && formCreateUser.get('passGroup.u_password').touched }">
    <div *ngIf="formCreateUser.get('passGroup.u_password').invalid && formCreateUser.get('passGroup.u_password').touched" class="invalid-feedback">
      Это поле обязательно
    </div>

    <label for="u_password2">Подтвердите пароль</label>
    <input id="u_password2" formControlName="u_password2" type="password" class="form-control"
           [ngClass]="{ 'is-valid': formCreateUser.get('passGroup.u_password2').valid && formCreateUser.get('passGroup.u_password2').touched,
                        'is-invalid': formCreateUser.get('passGroup.u_password2').invalid && formCreateUser.get('passGroup.u_password2').touched }">
    <div *ngIf="formCreateUser.get('passGroup.u_password2').invalid && formCreateUser.get('passGroup.u_password2').touched" class="invalid-feedback">
      Пароли не совпадают
    </div>
  </div>

  <!-- Поле u_role -->
  <div class="form-group">
    <label for="u_role">Роль</label>
    <input id="u_role" formControlName="u_role" type="text" class="form-control"
           [ngClass]="{ 'is-valid': formCreateUser.get('u_role').valid && formCreateUser.get('u_role').touched,
                        'is-invalid': formCreateUser.get('u_role').invalid && formCreateUser.get('u_role').touched }">
    <div *ngIf="formCreateUser.get('u_role').invalid && formCreateUser.get('u_role').touched" class="invalid-feedback">
      Это поле обязательно
    </div>
  </div>

  <button type="submit" class="btn btn-primary" [disabled]="formCreateUser.invalid">Создать</button>
</form>


        import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';

@Component({
  selector: 'app-create-user',
  templateUrl: './create-user.component.html',
})
export class CreateUserComponent implements OnInit {
  formCreateUser: FormGroup;

  constructor(private fb: FormBuilder) {}

  ngOnInit(): void {
    this.formCreateUser = this.fb.group({
      u_nombre: ['', Validators.required],
      u_login: ['', Validators.required],
      passGroup: this.fb.group({
        u_password: ['', Validators.required],
        u_password2: ['', Validators.required],
      }, { validator: matchPassword }),
      u_role: ['', Validators.required],
      receiveInfo: [true]
    });
  }

  onSubmit(): void {
    if (this.formCreateUser.valid) {
      console.log('Форма отправлена', this.formCreateUser.value);
    } else {
      console.log('Форма невалидна');
    }
  }
}

function matchPassword(group: FormGroup) {
  const password = group.get('u_password').value;
  const confirmPassword = group.get('u_password2').value;
  return password === confirmPassword ? null : { notMatching: true };
}

