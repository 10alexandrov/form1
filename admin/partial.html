<form action="/upload" method="POST" enctype="multipart/form-data">
    <label for="image">Upload an image:</label>
    <input type="file" id="image" name="image" accept="image/*" required onchange="previewImage(event)">
    <br><br>
    <img id="imagePreview" src="#" alt="Image Preview" style="display:none; max-width: 200px; max-height: 200px;">
    <br><br>
    <button type="submit">Upload</button>
</form>

<script>
    function previewImage(event) {
        const reader = new FileReader();
        const imageField = document.getElementById("imagePreview");

        reader.onload = function(){
            if(reader.readyState == 2){
                imageField.style.display = "block";
                imageField.src = reader.result;
            }
        }

        reader.readAsDataURL(event.target.files[0]);
    }
</script>
<style>

</style>

<form action="/upload" method="POST" enctype="multipart/form-data">
    @csrf
    <label for="image">Upload an image:</label>
    
    <!-- Поле загрузки изображения -->
    <input type="file" id="image" name="image" accept="image/*" onchange="previewImage(event)">

    <br><br>

    <!-- Превью изображения -->
    <img id="imagePreview" src="{{ $product->image ? asset('storage/' . $product->image) : '#' }}" alt="Image Preview"
        style="{{ $product->image ? 'display:block;' : 'display:none;' }} max-width: 200px; max-height: 200px;">

    <br><br>
    <button type="submit">Upload</button>
</form>

<script>
    function previewImage(event) {
        const reader = new FileReader();
        const imageField = document.getElementById("imagePreview");

        reader.onload = function(){
            if(reader.readyState == 2){
                imageField.style.display = "block";
                imageField.src = reader.result;
            }
        }

        reader.readAsDataURL(event.target.files[0]);
    }
</script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    // Объект для хранения количества нажатий для каждой кнопки
    const clickCounts = {};

    // Функция для обработки нажатий на кнопки
    function handleButtonClick(event) {
        const buttonId = event.target.id;
        
        // Проверка, существует ли уже запись для данной кнопки
        if (!clickCounts[buttonId]) {
            clickCounts[buttonId] = 0;
        }

        // Увеличение счетчика для данной кнопки
        clickCounts[buttonId]++;
        
        // Логирование текущего количества нажатий
        console.log(`Button ${buttonId} clicked ${clickCounts[buttonId]} times`);
    }

    // Получение всех кнопок с классом 'anadir'
    const buttons = document.querySelectorAll('.anadir');

    // Добавление обработчика событий на каждую кнопку
    buttons.forEach(button => {
        button.addEventListener('click', handleButtonClick);
    });
});
</script>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Button Click Tracker</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <!-- Пример кнопок -->
    <button class="anadir" id="button1">Button 1</button>
    <button class="anadir" id="button2">Button 2</button>
    <button class="anadir" id="button3">Button 3</button>

    <!-- Таблица для отображения результатов -->
    <table>
        <thead>
            <tr>
                <th>Button ID</th>
                <th>Click Count</th>
            </tr>
        </thead>
        <tbody>
            <tr class="factura-nueva"></tr>
        </tbody>
    </table>

    <script src="script.js"></script>
</body>
</html>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
    // Объект для хранения количества нажатий для каждой кнопки
    const clickCounts = {};

    // Функция для обработки нажатий на кнопки
    function handleButtonClick(event) {
        const buttonId = event.target.id;
        
        // Проверка, существует ли уже запись для данной кнопки
        if (!clickCounts[buttonId]) {
            clickCounts[buttonId] = 0;
        }

        // Увеличение счетчика для данной кнопки
        clickCounts[buttonId]++;
        
        // Логирование текущего количества нажатий
        console.log(`Button ${buttonId} clicked ${clickCounts[buttonId]} times`);

        // Обновление таблицы
        updateTable(buttonId, clickCounts[buttonId]);
    }

    // Функция для обновления таблицы
    function updateTable(buttonId, count) {
        const tableBody = document.querySelector('tbody');
        const existingRow = Array.from(tableBody.querySelectorAll('tr')).find(row => row.dataset.buttonId === buttonId);
        
        if (existingRow) {
            // Обновление существующей строки
            existingRow.querySelector('.click-count').textContent = count;
        } else {
            // Создание новой строки в таблице
            const newRow = document.createElement('tr');
            newRow.dataset.buttonId = buttonId;
            newRow.innerHTML = `
                <td>${buttonId}</td>
                <td class="click-count">${count}</td>
            `;
            tableBody.appendChild(newRow);
        }
    }

    // Получение всех кнопок с классом 'anadir'
    const buttons = document.querySelectorAll('.anadir');

    // Добавление обработчика событий на каждую кнопку
    buttons.forEach(button => {
        button.addEventListener('click', handleButtonClick);
    });
});
</script>


<script>
    // Отправка массива в контроллер

            // Пример массива объектов
            const products = [
            { id: 1, name: 'Product A', price: 10.0 },
            { id: 2, name: 'Product B', price: 20.0 }
        ];

        document.getElementById('sendData').addEventListener('click', function() {
            fetch('/factura/store', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({ products: products })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Data sent successfully:', data);
            })
            .catch(error => {
                console.error('Error sending data:', error);
            });
        });
    </script>

    <!-- CSRF Token for Laravel -->
    <meta name="csrf-token" content="{{ csrf_token() }}">


    <script>   

    public function store(Request $request)
    {
        // Получите массив объектов из запроса
        $products = $request->input('products');

        // Обработайте данные и сохраните их в базу данных
        foreach ($products as $product) {
            Factura::updateOrCreate(
                ['id' => $product['id']], // Поиск по ID для обновления существующих записей
                [
                    'name' => $product['name'],
                    'price' => $product['price']
                ]
            );
        }

        // Верните успешный ответ
        return response()->json(['message' => 'Data processed successfully!']);
    }



    namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Mercancia extends Model
{
    // Указываем, что таблица имеет составной ключ
    public $incrementing = false; // Отключаем автоинкремент, так как ключ составной

    protected $primaryKey = ['m_id_factura', 'm_id_producto']; // Составной ключ

    public $timestamps = false; // Если у вас нет полей created_at и updated_at

    // Метод для работы с составным ключом
    protected function getKeyName()
    {
        return $this->primaryKey;
    }

    // Переопределите метод для получения составного ключа
    public function getKey()
    {
        return [$this->m_id_factura, $this->m_id_producto];
    }
}


import { Component, OnInit } from '@angular/core';
import { DomSanitizer, SafeUrl } from '@angular/platform-browser';

interface Producto {
  product_id: number;
  p_nombre: string;
  p_category: number;
  p_foto: ArrayBuffer; // Или тип Uint8Array, если используется
}

@Component({
  selector: 'app-producto-list',
  templateUrl: './producto-list.component.html',
  styleUrls: ['./producto-list.component.css']
})
export class ProductoListComponent implements OnInit {
  productos: Producto[] = [];
  productosConImagen: { producto: Producto, imagenUrl: SafeUrl }[] = [];

  constructor(private sanitizer: DomSanitizer) {}

  ngOnInit(): void {
    // Предполагается, что массив productos уже инициализирован
    this.productos.forEach(producto => {
      const contentType = this.detectImageFormat(producto.p_foto); // Определяем формат изображения
      const base64String = this.arrayBufferToBase64(producto.p_foto);
      const imagenUrl = this.sanitizer.bypassSecurityTrustUrl(`data:${contentType};base64,${base64String}`);
      this.productosConImagen.push({ producto, imagenUrl });
    });
  }

  arrayBufferToBase64(buffer: ArrayBuffer): string {
    let binary = '';
    const bytes = new Uint8Array(buffer);
    const len = bytes.byteLength;
    for (let i = 0; i < len; i++) {
      binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
  }

  detectImageFormat(buffer: ArrayBuffer): string {
    const bytes = new Uint8Array(buffer);
    if (bytes[0] === 0xFF && bytes[1] === 0xD8 && bytes[2] === 0xFF) {
      return 'image/jpeg'; // JPEG
    } else if (bytes[0] === 0x89 && bytes[1] === 0x50 && bytes[2] === 0x4E && bytes[3] === 0x47) {
      return 'image/png'; // PNG
    }
    return 'image/jpeg'; // Дефолтный тип, если формат не распознан
  }
}

        // app.routes.ts
import { Routes } from '@angular/router';
import { HomeComponent } from './components/home/home.component';
import { AboutComponent } from './components/about/about.component';

export const routes: Routes = [
  { path: '', component: HomeComponent },
  { path: 'about', component: AboutComponent },
];
